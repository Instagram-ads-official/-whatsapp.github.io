<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">

  <!-- Meta Pixel (sin cambios) -->
  <script>
    const PIXEL_ID = '1391288831895635';
    !function(f,b,e,v,n,t,s){
      if(f.fbq) return; n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq) f._fbq=n; n.push=n; n.loaded=!0; n.version='2.0';
      n.queue=[]; t=b.createElement(e); t.async=!0;
      t.src=v; s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s);
    }(window, document, 'script',
      'https://connect.facebook.net/en_US/fbevents.js'
    );
    fbq('init', PIXEL_ID);
    fbq('track', 'ViewContent');
  </script>

  <!-- Script de captura y redirección -->
  <script>
    const API_URL = 'https://jxfyydlcu7.execute-api.us-east-2.amazonaws.com/prod/Capture_fbc';
    const whatsappNumbers = [
      '5491169771768','5491157506405','5491171635226',
      '5491162557202','5491171836710','5491171833570',
      '5491171833569','5491125737314'
    ];
    const mensajeBase = 'Hola vengo por el 200%!';

    function parseCookies(){
      return document.cookie
        .split('; ')
        .reduce((c,k) => {
          const [n, ...v] = k.split('=');
          c[n] = v.join('=');
          return c;
        }, {});
    }

    function generateUUID(){
      const bytes = new Uint8Array(16);
      crypto.getRandomValues(bytes);
      return Array.from(bytes)
        .map(b => b.toString(16).padStart(2,'0'))
        .join('');
    }

    (function(){
      const id = generateUUID();

      // Espero a que FB Pixel haya inicializado y escrito sus cookies
      fbq('get', PIXEL_ID, 'fbc', function(fbc){
        fbq('get', PIXEL_ID, 'fbp', function(fbp){
          const cookies = parseCookies();
          const payload = {
            event: 'ViewContent',
            timestamp: new Date().toISOString(),
            _fbc: fbc || cookies._fbc || null,
            _fbp: fbp || cookies._fbp || null,
            id
          };

          fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(payload)
          })
          .finally(() => {
            // redirección a WhatsApp con número aleatorio y UUID como código
            const num = whatsappNumbers[
              Math.floor(Math.random() * whatsappNumbers.length)
            ];
            const url = `https://wa.me/${num}?text=${encodeURIComponent(
              mensajeBase + ' Mi código es: ' + id
            )}`;
            location.href = url;
          });
        });
      });
    })();
  </script>

  <!-- Ocultamos cualquier posible contenido -->
  <style>
    html, body {
      display: none!important;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body></body>
</html>

